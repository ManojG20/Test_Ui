<script type="text/javascript" src="js/libs/pageSetup.js"></script>
<header>
	<h4><strong><font color="#5B0A0A">Real Time Traffic - Country Drilldown</font></strong></h4>


	<h5>
		<div class="dc-data-count">
        	<span class="filter-count"></span> selected out of <span class="total-count"></span> records | <a id="link" href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
    	</div>
    </h5>
</header>
<br><br>
<section id="widget-gird" class="">
	<div class="row">
		<article class="col-sm-12 col-md-12 col-lg-4">

			<!-- new widget -->
			<div class="jarviswidget" id="wid-id-109">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-100" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->

				<header>
					<span class="widget-icon"> <i class="fa fa-cube"></i> </span>
					<h2>Country Lists</h2>
					<div class="widget-toolbar hidden-mobile">
					</div>
				</header>
				
				<div class="jarviswidget-editbox">
					<div>
						<label>Title:</label>
							<input type="text" />
					</div>
				</div>
				<div class="widget-body">
			    	<div id="org-chart">
			        	<strong>Countries List</strong> 
			        	<a class="reset" href="javascript:orgChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        	<div class="clearfix"></div>
			    	</div>
				</div>
			</div>
		</article>
		<article class="col-sm-12 col-md-12 col-lg-8">

			<!-- new widget -->
			<div class="jarviswidget" id="wid-id-110">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-100" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->

				<header>
					<span class="widget-icon"> <i class="fa fa-cube"></i> </span>
					<h2>Total International Calls</h2>
				</header>
				
				<div class="jarviswidget-editbox">
					<div>
						<label>Title:</label>
							<input type="text" />
					</div>
				</div>
				<div class="widget-body">
	            	<div id="totCallsDim">
			        	<a class="reset" href="javascript:filterChart0910s.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        	<div class="clearfix"></div>
			    	</div>
				</div>
			</div>
		</article>
				<article class="col-sm-12 col-md-12 col-lg-8">

			<!-- new widget -->
			<div class="jarviswidget" id="wid-id-111">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-100" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->

				<header>
					<span class="widget-icon"> <i class="fa fa-cube"></i> </span>
					<h2>Total International Duration</h2>
				</header>
				
				<div class="jarviswidget-editbox">
					<div>
						<label>Title:</label>
							<input type="text" />
					</div>
				</div>
				<div class="widget-body">
					<div id="totDuration">
			        	<a class="reset" href="javascript:filterChart0910a.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        	<div class="clearfix"></div>
			    	</div>
				</div>
			</div>
		</article>
				<article class="col-sm-12 col-md-12 col-lg-8">

			<!-- new widget -->
			<div class="jarviswidget" id="wid-id-112">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-100" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->

				<header>
					<span class="widget-icon"> <i class="fa fa-cube"></i> </span>
					<h2>International Incoming Calls</h2>
				</header>
				
				<div class="jarviswidget-editbox">
					<div>
						<label>Title:</label>
							<input type="text" />
					</div>
				</div>
				<div class="widget-body">
					<div id="intIncCalls">
				        	<a class="reset" href="javascript:filterChart1011s.filterAll();dc.redrawAll();" style="display: none;">reset</a>
				        	<div class="clearfix"></div>
					</div> 
				</div>
			</div>
		</article>
				<article class="col-sm-12 col-md-12 col-lg-8">

			<!-- new widget -->
			<div class="jarviswidget" id="wid-id-113">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-100" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->

				<header>
					<span class="widget-icon"> <i class="fa fa-cube"></i> </span>
					<h2>International Incoming Duration</h2>
				</header>
				
				<div class="jarviswidget-editbox">
					<div>
						<label>Title:</label>
							<input type="text" />
					</div>
				</div>
				<div class="widget-body">
					<div id="intIncDuration">
			    	    <a class="reset" href="javascript:filterChart1112s.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			        	<div class="clearfix"></div>
			    	</div>   
				</div>
			</div>
		</article>
				</article>
				<article class="col-sm-12 col-md-12 col-lg-8">

			<!-- new widget -->
			<div class="jarviswidget" id="wid-id-114">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-100" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->

				<header>
					<span class="widget-icon"> <i class="fa fa-cube"></i> </span>
					<h2>International Outgoing Calls</h2>
				</header>
				
				<div class="jarviswidget-editbox">
					<div>
						<label>Title:</label>
							<input type="text" />
					</div>
				</div>
				<div class="widget-body">
					<div id="intOutCalls">
				        <a class="reset" href="javascript:filterChart1112s.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			    	    <div class="clearfix"></div>
			    	</div> 
				</div>
			</div>
		</article>
				</article>
				<article class="col-sm-12 col-md-12 col-lg-8">

			<!-- new widget -->
			<div class="jarviswidget" id="wid-id-115">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-100" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->

				<header>
					<span class="widget-icon"> <i class="fa fa-cube"></i> </span>
					<h2>International Outgoing Duration</h2>
				</header>
				
				<div class="jarviswidget-editbox">
					<div>
						<label>Title:</label>
							<input type="text" />
					</div>
				</div>
				<div class="widget-body">
				 	<div id="intOutDuration">
				        <a class="reset" href="javascript:filterChart1112a.filterAll();dc.redrawAll();" style="display: none;">reset</a>
			    	    <div class="clearfix"></div>
			    	</div>
				</div>
			</div>
		</article>		
	</div>
<div class = "row">
	<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<div class="jarviswidget jarviswidget-color-darken" id="wid-id-108" data-widget-editbutton="false">
					<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>Country Snapshot</h2>

				</header>

				<!-- widget div-->
				<div class="no-padding">
					<!-- widget edit box -->
					<div class="jarviswidget-editbox">

					</div>
					<!-- end widget edit box -->

					<div class="widget-body">
						<!-- content -->
						<div id="myTabContent" class="tab-content">
							<div class="tab-pane fade active in padding-10 no-padding-bottom" id="s1">
								<div class="row no-space">
									<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
										<div class="widget-body no-padding">

											<table id="datatable_fixed_columns" class="table table-striped table-bordered table-hover dc-data-table" width="100%" data-ng-controller="triggerDataCtrl">
										        <thead>
				        							<tr class="header">
				        								<th>CSN</th>	
				      							  		<th>Country Code</th>
				        								<th>Country Name</th>
										        		<th>Total Calls</th>	
				        								<th>Total Duration</th>	
										        		<th>INT-IN calls</th>	
				        								<th>INT-IN Duration</th>	
										        		<th>INT-OUT Calls</th>	
				        								<th>INT-OUT Duration</th> 
				        							</tr>
				        						</thead>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			
		</div>
	</article>

</div>
</section>

<script type="text/javascript">

var orgChart = dc.rowChart("#org-chart");
var filterChart0910a = dc.lineChart("#totCallsDim");
var filterChart1011a = dc.lineChart("#intIncCalls");
var filterChart1112a = dc.lineChart("#intOutCalls");
var filterChart0910s = dc.lineChart("#totDuration");
var filterChart1011s = dc.lineChart("#intIncDuration");
var filterChart1112s = dc.lineChart("#intOutDuration");

d3.json("../services/getCountryStat.xsjs", function (data) {
			var dateArray = [];
			data.forEach(function (e) {
				e.tt = new Date(e.tt);
				e.hour = d3.time.minute(e.tt)
				//console.log("date",e.cd, e.hour);
				//console.log("iictot", e.iictot);
				e.iictot = e.iictot == null ? 0 : e.iictot;
				//console.log("iictot", e.iictot);
				e.iicdur = e.iicdur == null ? 0 : e.iicdur;
				e.iogtot = e.iogtot == null ? 0 : e.iogtot;
				e.iogdur = e.iogdur == null ? 0 : e.iogdur;
				e.itotCalls = e.iictot + e.iogtot;
				e.itotdur = e.iicdur + e.iogdur;
				//console.log("total calls and duration", e.itotCalls, e.itotdur);
				dateArray.push(e.hour);
			});
			var minDate = d3.min(dateArray);
			var maxDate = d3.max(dateArray);
			console.log("Min Date", minDate);
			console.log("Max Date", maxDate);
            // feed it through crossfilter
            var ndx = crossfilter(data);
            var all = ndx.groupAll();
			
			var totCallsDim = ndx.dimension(function (d) {
				return d.hour;
            });
            var totGrp = totCallsDim.group().reduceSum(function(v) { 
            	return v.itotCalls; 
            });
			console.log("Finding out Minimum date and Maximum date");
			//var minDate = totalCallsDim.bottom(1)[0].date;
			//var maxDate = totalCallsDim.top(1)[0].date;
			//console.log("Min and Max dates:", minDate, maxDate);
			//print_group(totGrp);
			//console.log("If you are seeing me, then you might have seen the group");
      		var totDurDim = ndx.dimension(function (d) {
                return d.hour;
            });
            var totDurGrp = totDurDim.group().reduceSum(function(v) { 
            	return v.itotdur; 
            });      		
			var icDim = ndx.dimension(function (d) {
                return d.hour;
            });
            var icGrp = icDim.group().reduceSum(function(v) { 
            	return v.iictot; 
            });
      		var icDurDim = ndx.dimension(function (d) {
                return d.hour;
            });
            var icDurGrp = icDurDim.group().reduceSum(function(v) { 
            	return v.iicdur; 
            });
            var ogDim = ndx.dimension(function (d) {
                return d.hour;
            });
            var ogGrp = ogDim.group().reduceSum(function(v) { 
            	return v.iogtot; 
            });
      		var ogDurDim = ndx.dimension(function (d) {
                return d.hour;
            });
            var ogDurGrp = ogDurDim.group().reduceSum(function(v) { 
            	return v.iogdur; 
            });
      		var country_dim = ndx.dimension(function (d) {
                return d.ccshname;
            });
            var country_grp = country_dim.group();
      		
      		var description_dim = ndx.dimension(function (d) {
                return d.cccode;
            });
      		/*var vote_dim = ndx.dimension(function (d) {
                return d.Vote;
            });*/
      		
			console.log("Going to Plot Graph, Successfully came past the dim and group");
      		orgChart.width(280) // (optional) define chart width, :default = 200
			    .height(3600) // (optional) define chart height, :default = 200
			    .dimension(country_dim) // set dimension
			    .group(country_grp) // set group
			    .margins({top: 20, left: 10, right: 10, bottom: 20})
			    .colors(['#D462FF', '#736AFF', '#92C7C7', '#595454', '#E3319D', '#FF00FF', '#666362', '#E56E94', '#3090C7', '#8B31C7', '#C8BBBE', '#342D7E', '#646060', '#2554C7', '#E238EC', '#1569C7', '#CFECEC', '#544E4F', '#728FCE', '#3EA99F', '#7F38EC', '#737CA1', '#7D0541', '#8EEBEC', '#736F6E', '#4C4646', '#6A287E', '#565051', '#46C7C7', '#F6358A', '#1589FF', '#7FFFD4', '#810541', '#38ACEC', '#4A4344', '#3BB9FF', '#4E4848', '#9AFEFF', '#C031C7', '#2B60DE', '#B93B8F', '#6D7B8D', '#15317E', '#8467D7', '#737CA1', '#41627E', '#EBDDE2', '#4863A0', '#5F5A59', '#BDEDFF', '#C6DEFF', '#504A4B', '#667C26', '#726E6D', '#348781', '#48CCCD', '#7E587E', '#307D7E', '#6698FF', '#306EFF', '#153E7E', '#357EC7', '#646D7E', '#AFDCEC', '#254117', '#A23BEC', '#CA226B', '#50EBEC', '#C12283', '#4E9258', '#B7CEEC', '#B4CFEC', '#F0F8FF', '#347235', '#E9CFEC', '#E4287C', '#FCDFFF', '#95B9C7', '#157DEC', '#6D6968', '#6960EC', '#41383C', '#78c7c7', '#7D053F', '#6E6A6B', '#F535AA', '#79BAEC', '#C6AEC7', '#D2B9D3', '#B048B5', '#7D1B7E', '#87AFC7', '#2B3856', '#56A5EC', '#657383', '#82CAFF', '#488AC7', '#F9B7FF', '#F52887', '#747170', '#F433FF', '#9172EC', '#F6358A', '#43C6DB', '#57FEFF', '#52F3FF', '#82CAFA', '#25587E', '#43BFC7', '#6C2DC7', '#616D7E', '#4C7D7E', '#F0FFFF', '#617C58', '#566D7E', '#8D38C9', '#7D0552', '#B041FF', '#C45AEC', '#306754', '#98AFC7', '#347C2C', '#151B54', '#4E387E', '#2B547E', '#A0CFEC', '#806D7E', '#717D7D', '#800517', '#00FFFF', '#E4317F', '#696565', '#461B7E', '#5E7D7E', '#D16587', '#2B65EC', '#463E3F', '#4EE2EC', '#E3E4FA', '#ADDFFF', '#FDEEF4', '#5E767E', '#4C787E', '#387C44', '#E0FFFF', '#5E5A80', '#C38EC7', '#C2DFFF', '#893BFF', '#7A5DC7', '#C12869', '#4E8975', '#463E41', '#571B7E', '#8E35EF', '#151B8D', '#842DCE', '#F778A1', '#E6A9EC', '#77BFC7', '#625D5D', '#659EC7', '#9E7BFF', '#25383C', '#C25A7C', '#3B9C9C', '#5CB3FF', '#A74AC7', '#7E354D', '#5C5858', '#AFC7C7', '#C12267'])
			    .gap(1)
			    .renderLabel(true)
			    .renderTitle(true)
			    .xAxis().ticks(4);
			 filterChart0910a.width(640)
                    .height(360)
					.transitionDuration(1000)
					//.mouseZoomable(true)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(totCallsDim)
					//.mouseZoomable(true)
					.x(d3.time.scale().domain([minDate, maxDate]))
					.round(d3.time.hour.round)
					.xUnits(d3.time.hours)
                    .group(totGrp)
                    .elasticY(true)
                    .renderHorizontalGridLines(true)
					.brushOn(false)
					//.colors('red')
                    .xAxis();

             filterChart0910s.width(640)
                    .height(360)
					.transitionDuration(1000)
					//.mouseZoomable(true)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(totDurDim)
					.x(d3.time.scale().domain([minDate, maxDate]))
					.round(d3.time.hour.round)
					.xUnits(d3.time.hours)
                    .group(totDurGrp)
                    .elasticY(true)
                    .renderHorizontalGridLines(true)
					.brushOn(false)
                    .xAxis()

              filterChart1011a.width(640)
                    .height(360)
					.transitionDuration(1000)
					//.mouseZoomable(true)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(icDim)
					.x(d3.time.scale().domain([minDate, maxDate]))
					.round(d3.time.hour.round)
					.xUnits(d3.time.hours)
                    .group(icGrp)
                    .elasticY(true)
                    .renderHorizontalGridLines(true)
                    .xAxis()

             filterChart1011s.width(640)
                    .height(360)
					.transitionDuration(1000)
					//.mouseZoomable(true)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(icDurDim)
					.x(d3.time.scale().domain([minDate, maxDate]))
					.round(d3.time.hour.round)
					.xUnits(d3.time.hours)
                    .group(icDurGrp)
                    .elasticY(true)
                    .renderHorizontalGridLines(true)
                    .xAxis()
    
             filterChart1112a.width(640)
                    .height(360)
					.transitionDuration(1000)
					//.mouseZoomable(true)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(ogDim)
					.x(d3.time.scale().domain([minDate, maxDate]))
					.round(d3.time.hour.round)
					.xUnits(d3.time.hours)
                    .group(ogGrp)
                    .elasticY(true)
                    .renderHorizontalGridLines(true)
                    .xAxis()

             filterChart1112s.width(640)
                    .height(360)
					.transitionDuration(1000)
					//.mouseZoomable(true)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(ogDurDim)
					.x(d3.time.scale().domain([minDate, maxDate]))
					.round(d3.time.hour.round)
					.xUnits(d3.time.hours)
                    .group(ogDurGrp)
                    .elasticY(true)
                    .renderHorizontalGridLines(true)
                    .xAxis()
    
            
            dc.dataCount(".dc-data-count")
                    .dimension(ndx)
                    .group(all);

            dc.dataTable(".dc-data-table")
                    .dimension(description_dim)
                    .group(function (d) {
                        return d.ccshname;
                    })
                    .size(600)
                    .columns([
                    	function (d) {
                            return d.ccshname;
                        },
                        function (d) {
                            return d.cccode;
                        },
                        function (d) {
                            return d.ccname;
                        },
                        function (d) {
                            return d.itotCalls;
                        },
                        function (d) {
                            return d.itotdur;
                        },
                        function (d) {
                            return d.iictot;
                        },
                        function (d) {
                            return d.iicdur;
                        },
                        function (d) {
                            return d.iogtot;
                        },
                        function (d) {
                            return d.iogdur;
                        }	
                    ])
                    .sortBy(function (d) {
                        return d.ccshname;
                    })
                    .order(d3.ascending)
                    .renderlet(function (table) {
                        table.selectAll(".dc-table-group").classed("info", true);
                    });
					
			console.log("Finishing Charting");

            dc.renderAll();
			
            }
		);

</script>
